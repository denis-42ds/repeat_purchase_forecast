# Название проекта: Построение ML-продукта для предсказания повторной покупки покупателя

## Заказчик: Маркетинговая компания

## Статус проекта: завершён

## Описание рабочих файлов:
- `requirements.txt` - библиотеки Python, необходимые для работы проекта, а также их версии
- `ecom_forecast.ipynb` - рабочая тетрадь с исследованиями, визуализациями и текстовыми описаниями
- `research_class.py` - файл, содержащий класс для проведения исследования

## Описание проекта
<br>Предоставлено три файла - каждый файл это отдельный интернет-магазин:
- marketplace – мультикатегорийный магазин с посещаемостью более 8-ми млн сессий в месяц, 
- apparel – магазин одежды, по характеристикам похожий на маркетплейс, 
- gifts - очень маленький магазин подарков.

<br>В данных - обезличенная история покупок клиентов за определенный период.

## Цель проекта
- Необходимо создать решение для предсказания совершения покупателем повторной покупки в течение ближайших 30-ти дней 

## Задачи:
- Необходимо выбрать и обосновать метрику (Заказчику важен положительный класс покупателей),
- предложить решение, способное с высокой вероятностью предсказывать поведение клиентов.

## Ход исследования
- загрузка данных и ознакомление с ними,
- EDA,
- создание новых признаков,
- отбор финального набора обучающих признаков,
- подготовка данных для обучения,
- выбор и обучение моделей,
- оценка качества предсказания лучшей модели на тестовой выборке,
- анализ важности признаков лучшей модели,
- отчёт по проведённому исследованию.

## Используемые инструменты
Python: catboost, datetime, matplotlib, numpy, pandas, phik, prophet, seaborn, sklearn, statsmodels 

## Заключение:
<br>Отчёт по выполненным в ходе исследования шагам.
1. Загрузка данных и ознакомление с ними
  <br>Шаг выполнен полностью, трудностей не возникло.
  - данные загружены при помощи модуля `pandas`;
  - проведено исследование на наличие пропусков;
  - данные проверены на повторы строк;
  - выявлено количество уникальных клиентов в предоставленных данных;
  - изучены признаки количества и цен;
  - проверен временной интервал, в течение которого проводились наблюдения;
  - датасеты очищены от неинформативных признаков.
  
2. Предобработка и создание новых признаков
  <br>Шаг выполнен полностью, трудностей не возникло.
  - Произведена группировка по дням и клиентам;
  - добавлен целевой признак `target`;
  - добавлены признаки `cumulative_sum`, `is_holiday`;
  - удалены записи за последние 30 дней;
  - проанализирован баланс классов;
  - произведён анализ корреляций между признаками.
  
3. Анализ сезонности и стационарности
  <br>Шаг выполнен на 100%, трудностей не возникло.
  - Произведено разложение временного ряда на тренд, сезонность и остатки;
  - проведён тест Дики-Фуллера для заключения о стационарности.

4. Подготовка признаков к обучению моделей
  <br>Шаг выполнен полностью, трудностей при выполнении не возникло.
  - произведено масштабирование числовых признаков;
  - произведено разделение данных на обучающий и тестовый наборы.
  
5. Обучение моделей
  <br>При обучении модели возникли трудности с получением результатов.
  <br>Появились сомнения в корректности применённого подхода.
  <br>Есть идея: сделать обучение в цикле по каждому клиенту,
  <br>но при первом запуске это заняло достаточно много времени
  <br>без получения результата.

  - для каждого магазина обучены три модели: `Logistic Regression` (Baseline), `FB Prophet`, `Catboost`;
  - получены метрики `roc-auc`, `recall`, `precision`;
  - визуализирован процесс обучения.
  
6. Выбор лучшей модели
  <br>Шаг выполнен полность, трудностей не возникло.
  - Модели выбирались по оптимальному соотношению трёх метрик:
    + для маркетплейса и магазина одежды наилучшим образом себя показала модель `Catboost`
    + для построения прогнозов для магазина подарков пока можно не использовать мощности машинного обучения;
  - матрицы ошибок показали, что модель хорошо определяет класс 0 и часто ошибается в 1;
  - три наиболее важных для модели признака - `sum_price`, `quantity`, `cumulative_sum`.

По итогам исследования можно сделать заключение, что наиболее подходящей моделью для решения
<br>поставленной задачи Заказчика является модель градиентного бустинга `CatBoost`
